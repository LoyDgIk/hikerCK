{"last_chapter_rule":"","pageList":[{"col_type":"movie_3","name":"å¤¸å…‹åˆ—è¡¨API","path":"QuarkShareApi","rule":"js:\n//@author LoyDgIk\nlet httpRequest = $.require(\"httpRequest\");\nlet fromDrive = module.importParam;\nlet pr, baseUrl\nif (fromDrive === \"uc\") {\n    baseUrl = \"https://pc-api.uc.cn\";\n    pr = \"UCBrowser\";\n} else {\n    baseUrl = \"https://pan.quark.cn\";\n    pr = \"ucpro\";\n}\n\nfunction QuarkShareApi(shareId, sharePwd) {\n    this.shareId = shareId;\n    this.sharePwd = sharePwd;\n    this.refreshCallBack = (() => void 0);\n    //this.shareToken = shareToken || this.getShareToken();\n}\nObject.assign(QuarkShareApi.prototype, {\n    setRefresh(refreshCallBack) {\n        this.refreshCallBack = refreshCallBack;\n        return this;\n    },\n    setToken(shareToken) {\n        this.shareToken = shareToken;\n        return this;\n    },\n    requestHttp(api) {\n        return new httpRequest(baseUrl+api).success((body) => {\n            if (body.status !== 200) {\n                throw new Error(body.message);\n            }\n            return body;\n        });\n    },\n    getToken() {\n        return this.shareToken || this.getShareToken();\n    },\n\n    getShareToken() {\n        let result = this.requestHttp(\"/1/clouddrive/share/sharepage/token\").body({\n            \"pwd_id\": this.shareId,\n            \"passcode\": this.sharePwd,\n        }).bodyToString(true).setStartRequestFunc(post).start(true);\n        this.shareToken = result.data.stoken;\n        this.refreshCallBack(result.data.stoken, this);\n        return this.shareToken;\n    },\n    getListFile(fileId, page, orderBy) {\n        let result = this.requestHttp(\"/1/clouddrive/share/sharepage/detail?pr=\"+pr+\"&fr=pc\").buildUrl({\n            pwd_id: this.shareId || \"\",\n            stoken: encodeURIComponent(this.getToken() || \"\"),\n            pdir_fid: fileId || \"\",\n            force: 0,\n            _page: page,\n            _size: 100,\n            _fetch_banner: 1,\n            _fetch_share: 1,\n            _fetch_total: 1,\n            _sort: \"file_type:asc,\" + orderBy\n        }).errorWithRetry((err, res, http) => {\n            if (JSON.parse(res.body).message.includes('stoken')) {\n                http.mergeHeadAndBody({\n                    buildUrl: {\n                        stoken: encodeURIComponent(this.getShareToken()||\"\")\n                    }\n                });\n                return true;\n            }\n        }).start(true);\n        return result;\n    }\n});\n$.exports = QuarkShareApi;"},{"col_type":"movie_3","name":"httpRequest","path":"httpRequest","rule":"function httpRequest(url, options) {\n    this.retryCount = 0;\n    this.url = url;\n    this.options = Object.assign({}, options, {\n        withHeaders: true\n    });\n    this.errorCallback = (err, res) => {throw err};\n    this.errorCallbackWithRetry = (err, res, tryRestart) => false;\n    this.successCallback = (body, statusCode, headers) => body;\n    this.errorTypeCallback = (err, res) => err;\n    this.startRequest = fetch;\n    this._bodyToString = false;\n    this.buildParam = void(0);\n}\n\nObject.assign(httpRequest.prototype, {\n    bodyToString(flag) {\n        this._bodyToString = !!flag;\n        return this;\n    },\n    body(body) {\n        this.options.body = body || void 0;\n        return this;\n    },\n    buildUrl(buildParam) {\n        this.buildParam = buildParam || {};\n        return this;\n    },\n    setStartRequestFunc(func) {\n        this.startRequest = func;\n        return this;\n    },\n    headers(headers) {\n        this.options.headers = headers || void 0;\n        return this;\n    },\n    success(successCallback) {\n        if (typeof successCallback !== \"function\") return this;\n        this.successCallback = successCallback;\n        return this;\n    },\n    error(errorCallback) {\n        if (typeof errorCallback !== \"function\") return this;\n        this.errorCallback = errorCallback;\n        return this;\n    },\n    errorType(errorTypeCallback) {\n        if (typeof errorTypeCallback !== \"function\") return this;\n        this.errorTypeCallback = errorTypeCallback;\n        return this;\n    },\n    errorWithRetry(retryCount, errorCallbackWithRetry) {\n        if (typeof retryCount === \"function\" && typeof errorCallbackWithRetry === \"undefined\") {\n            errorCallbackWithRetry = retryCount;\n            retryCount = 1;\n        }\n        if (typeof errorCallbackWithRetry !== \"function\") {\n            return this;\n        }\n        this.retryCount = Number(retryCount);\n        this.errorCallbackWithRetry = errorCallbackWithRetry;\n        return this;\n    },\n    start(toJson) {\n        let options = Object.assign({}, this.options);\n        if (typeof options.body === \"object\" && this._bodyToString) {\n            options.body = JSON.stringify(options.body);\n        }\n        var res = JSON.parse(this.startRequest(this.buildParam?buildUrl(this.url, this.buildParam):this.url, options));\n        try {\n            if (res.statusCode >= 200 && res.statusCode <= 300) {\n                let body = res.body;\n                if (toJson) {\n                    body = JSON.parse(body);\n                }\n                return this.successCallback(body, res);\n            } else {\n                throw new Error(String(res.statusCode));\n            }\n        } catch (err) {\n            try {\n                err = this.errorTypeCallback(err, res);\n            } catch (e) {\n\n            }\n            if (this.retryCount) {\n                let tryResult = this.errorCallbackWithRetry(err, res, this);\n                if (tryResult) {\n                    this.retryCount--;\n                    return this.start(toJson);\n                } else {\n                    this.retryCount = 0;\n                    return this.errorCallback(err, res);\n                }\n            } else {\n                return this.errorCallback(err, res);\n            }\n        }\n    },\n    setOptions(options) {\n        this.options = Object.assign({}, options, {\n            withHeaders: true\n        });\n        return this;\n    },\n    mergeHeadAndBody(options) {\n        options = options || {};\n        Object.assign(this.options.headers||{}, options.headers);\n        if (typeof this.options.body === \"object\" && typeof options.body === \"object\") {\n            Object.assign(this.options.body||{}, options.body);\n        }\n        if (typeof options.buildUrl === \"object\") {\n            Object.assign(this.buildParam||{}, options.buildUrl);\n        }\n        return this;\n    }\n});\n\nObject.assign(httpRequest, {\n    fetch(url, options) {\n        return new httpRequest(url, options);\n    },\n    post(url, options) {\n        return new httpRequest(url, options).setStartRequestFunc(post);\n    },\n    request(url, options) {\n        return new httpRequest(url, options).setStartRequestFunc(request);\n    },\n    postRequest(url, options) {\n        return new httpRequest(url, options).setStartRequestFunc(postRequest);\n    },\n    fetchCookie(url, options) {\n        return new httpRequest(url, options).setStartRequestFunc(fetchCookie);\n    }\n});\n$.exports = httpRequest;"},{"col_type":"movie_3","name":"å¤¸å…‹åˆ—è¡¨","path":"quarkList","rule":"js:\nlet d = [];\n\naddListener(\"onClose\", () => clearMyVar(\"playUrlCache\"));\naddListener(\"onRefresh\", () => clearMyVar(\"playUrlCache\"));\nlet soUrl = decodeURIComponent(getParam(\"realurl\", \"\"));\nlet fromDrive = MY_PARAMS.fromDrive||\"quark\";\n\nif(soUrl.includes(\"drive.uc.cn\")){\n    fromDrive = \"uc\";\n}\nlet realurl = soUrl.split(\"?\")[0];\nlet urlData = realurl.split(\"/\");\n\nlet shareId = MY_PARAMS.shareId || urlData[4].replace(\"#\", \"\");\nlet sharePwd = getParam(\"sharePwd\", MY_PARAMS.sharePwd || getParam(\"passcode\", \"\", soUrl) || \"\");\nlet shareToken = getParam(\"shareToken\", MY_PARAMS.shareToken || \"\");\n\nlet fileId = MY_PARAMS.fileId;\n\nlet sort = {\n    \"åç§°æ­£åº\": \"file_name:asc\",\n    \"åç§°å€’åº\": \"file_name:desc\",\n    \"æ—¶é—´æ­£åº\": \"updated_at:asc\",\n    \"æ—¶é—´å€’åº\": \"updated_at:desc\"\n};\nlet styles = [\"text_1\", \"avatar\"];\n\nlet sortValue = sort[getItem(\"sortKey\", \"åç§°æ­£åº\")];\nlet style = getItem(\"style\", styles[0]);\nif (MY_PAGE == 1) {\n    d.push({\n        title: fromDrive===\"uc\"?\"UCç½‘ç›˜\":\"å¤¸å…‹ç½‘ç›˜\",\n        col_type: \"icon_5\",\n        pic_url: fromDrive===\"uc\"?\"https://hikerfans.com/tubiao/erdi/14.png\":\"hiker://images/icon_kuake\",\n        url: $(\"ç‚¹å‡»åŠŸèƒ½æŒ‰é’®=>ä¸ªäººè´¦å·ç®¡ç†å³å¯ç™»å½•è´¦å·\").confirm(()=>{}),\n    });\n    d.push({\n        title: style,\n        url: $(styles, 1, 'è¯·é€‰æ‹©').select(() => {\n            setItem('style', input);\n            refreshPage();\n        }),\n        pic_url: \"https://hikerfans.com/img/ali_icon.svg\",\n        col_type: \"icon_5\"\n    });\n    d.push({\n        title: getItem(\"sortKey\", \"åç§°æ­£åº\"),\n        url: $(Object.keys(sort), 1, 'è¯·é€‰æ‹©').select(() => {\n            setItem(\"sortKey\", input)\n            refreshPage();\n        }),\n        pic_url: \"https://hikerfans.com/img/ali_sort.svg\",\n        col_type: \"icon_5\"\n    });\n    d.push({\n        title: getItem(\"quark_playMode\", \"è½¬ç \"),\n        url: $([\"è½¬ç \", \"åŸç”»\", \"æ™®é€šåŸç”»\"], 2, \"æ’­æ”¾æ¨¡å¼\").select(() => {\n            setItem(\"quark_playMode\", input);\n            refreshPage();\n            return \"toast://åˆ‡æ¢æˆåŠŸ\";\n        }),\n        col_type: \"icon_5\",\n        pic_url: \"https://hikerfans.com/img/ali_play.svg\",\n    });\n    d.push({\n        title: \"åŠŸèƒ½\",\n        url: $([\"è·³è½¬å¤¸å…‹APP\", \"å¤åˆ¶åˆ†äº«é“¾æ¥\", \"ä¸ªäººè´¦å·ç®¡ç†\", \"åŸç”»ä¸‹è½½çº¿ç¨‹\"], 2).select((shareId, sharePwd) => {\n            if (input === \"è·³è½¬å¤¸å…‹APP\") {\n                return \"qklink://www.uc.cn/b20b84fd735a8dd3f7541129bacc4e9a?action=open_url&url=https://pan.quark.cn/s/\" + shareId;\n            } else if (input === \"ä¸ªäººè´¦å·ç®¡ç†\") {\n                return $.require(\"account\");\n            } else if (input === \"åŸç”»ä¸‹è½½çº¿ç¨‹\") {\n                return $(getItem(\"speedThread\", \"10\"), \"è¯·è¾“å…¥3-32ä¹‹é—´çš„æ•´æ•°\").input(() => {\n                    let speedThread = parseInt(input);\n                    if (speedThread < 3 || speedThread > 32) {\n                        return \"toast://è®¾ç½®ä¸åˆæ³•\";\n                    }\n                    setItem(\"speedThread\", String(speedThread));\n                    return \"toast://è®¾ç½®æˆåŠŸ\";\n                });\n            } else if (input === \"å¤åˆ¶åˆ†äº«é“¾æ¥\") {\n                return \"copy://\" + buildUrl(\"https://pan.quark.cn/s/\" + shareId, {\n                    passcode: sharePwd\n                });\n            }\n        }, shareId, sharePwd),\n        col_type: \"icon_5\",\n        pic_url: \"https://hikerfans.com/img/ali_fileinto.svg\",\n    });\n    d.push({\n        col_type: 'line_blank'\n    });\n}\n\n\nlet QuarkShareApi = $.require(\"QuarkShareApi\", fromDrive);\nlet quarkShareApi = new QuarkShareApi(shareId, sharePwd).setToken(shareToken).setRefresh((shareToken) => {\n    MY_PARAMS.shareToken = shareToken;\n    setPageParams(MY_PARAMS);\n});\n\nfunction formatSize(size) {\n    if (!size) {\n        return '';\n    }\n    const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n    let i = 0;\n    while (size >= 1024) {\n        size /= 1024;\n        i++;\n    }\n    size = i ? Number(size.toFixed(2)) : size;\n    return `${size} ${units[i]}`;\n}\n\nlet subExts = [\"vtt\", \"srt\", \"ass\"];\nlet titleHead = {\n    video: \"ğŸ¬\",\n    audio: \"ğŸµ\",\n    doc: \"ğŸ“‘\",\n    image: \"ğŸ–¼\",\n    archive: \"ğŸ“¦\",\n    \"default\": \"â“\"\n};\n\nfunction getHead(type, ext) {\n    let head = titleHead[type];\n    /*if (subExts.includes(ext)) {\n        head = \"ğŸ•¸\";\n    }*/\n    return head || \"â“\";\n}\ntry {\n    var res = quarkShareApi.getListFile(fileId, MY_PAGE, sortValue);\n    //è®¾ç½®æ ‡é¢˜\n    setPageTitle(res.data.share.title);\n    var list = res.data.list || [];\n    if (list.length === 0 && !fileId) {\n        res = quarkShareApi.getListFile(res.data.share.first_fid, MY_PAGE, sortValue);\n        setPageTitle(res.data.share.title);\n        var list = res.data.list || [];\n    }\n    list.forEach(item => {\n        //åˆ¤æ–­æ˜¯å¦æ–‡ä»¶å¤¹\n        if (item.dir) {\n            d.push({\n                title: \"ğŸ“‚\" + item.file_name,\n                desc: $.dateFormat(item.updated_at, 'yyyy-MM-dd') + '  ' + item.include_items + 'é¡¹  ',\n                pic_url: \"https://hikerfans.com/tubiao/messy/27.svg\",\n                url: \"hiker://page/quarkList?page=fypage\",\n                col_type: style,\n                extra: {\n                    shareId,\n                    sharePwd,\n                    shareToken: quarkShareApi.getToken(),\n                    fileId: item.fid,\n                    inheritTitle: false,\n                    fromDrive\n                }\n            });\n        } else {\n            d.push({\n                title: getHead(item.obj_category) + item.file_name,\n                desc: $.dateFormat(item.updated_at, 'yyyy-MM-dd') + '  ' + formatSize(item.size),\n                pic_url: item.thumbnail,\n                url: $().lazyRule((fid, fid_token, pwd_id, stoken, category, fromDrive) => {\n                    let playUrlCache = storage0.getMyVar(\"playUrlCache\", {});\n                    if (playUrlCache[fid]) {\n                        return playUrlCache[fid];\n                    } else {\n                        let url = $.require(\"play\", fromDrive).getPlayUrl(fid, fid_token, pwd_id, stoken, category);\n                        playUrlCache[fid] = url;\n                        storage0.putMyVar(\"playUrlCache\", playUrlCache);\n                        return url;\n                    }\n                }, item.fid, item.share_fid_token, shareId, quarkShareApi.getToken(), item.obj_category, fromDrive),\n                col_type: style,\n                extra: {\n                    id: item.fid,\n                    inheritTitle: false,\n                    cls: 'playlist ' + item.obj_category\n                }\n            })\n        }\n        \n    });\n} catch (e) {\n    d.push({\n        title: e.message,\n        url: 'hiker://empty',\n        col_type: 'text_center_1',\n        extra: {\n            lineVisible: false\n        }\n    });\n    if (e.message.includes(\"æå–ç \")) {\n        d.push({\n            title: \"è¾“å…¥æå–ç \",\n            url: $().input((MY_PARAMS) => {\n                setPageParams(Object.assign({}, MY_PARAMS, {\n                    sharePwd: input\n                }));\n                refreshPage();\n            }, MY_PARAMS),\n            col_type: \"text_center_1\"\n        });\n    }\n}\nsetResult(d);"},{"col_type":"movie_3","name":"play","path":"play","rule":"js:\nlet fromDrive = module.importParam;\nlet pr, homeUrl, api, cookie;\nif (fromDrive === \"uc\") {\n    homeUrl = \"https://drive.uc.cn/\";\n    pr = \"UCBrowser\";\n    api = \"https://pc-api.uc.cn\";\n    cookie = getItem(\"ucCookie\", \"\");\n} else {\n    homeUrl = \"https://drive.quark.cn/\";\n    pr = \"ucpro\";\n    api = \"https://drive.quark.cn\";\n    cookie = getItem(\"quarkCookie\", \"\");\n}\n\nfunction CookieManage(cookie) {\n    this.cookie = {};\n    this.add(cookie);\n}\nObject.assign(CookieManage.prototype, {\n    add(cookie) {\n        let cookies = [];\n        if (typeof cookie === \"string\") {\n            cookies = cookie.split(\";\");\n        } else if (Array.isArray(cookie)) {\n            cookies = cookie;\n        }\n        cookies.forEach(v => {\n            v = v.split(\"=\");\n            if (v.length < 2) return;\n            this.cookie[v[0].trim()] = v[1].trim();\n        });\n    },\n    get() {\n        return Object.entries(this.cookie).map(v => v[0] + \"=\" + v[1]).join(\";\");\n    }\n});\nconst cookieManage = new CookieManage(cookie);\nlet httpRequest = $.require(\"httpRequest\");\n\nfunction waitSleep(time) {\n    java.lang.Thread.sleep(time || 600);\n}\n\nfunction requestHttp(url) {\n    return new httpRequest(url)\n        .success((body, res) => {\n            if (body.status !== 200) {\n                throw new Error(body.message);\n            }\n            log(url);\n            log(res.headers)\n            cookieManage.add(res.headers[\"set-cookie\"]);\n            return body;\n        })\n        .errorType((err, res) => {\n            return new Error(JSON.parse(res.body).message);\n        })\n        .bodyToString(true)\n        .headers({\n            cookie: cookieManage.get(),\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) quark-cloud-drive/2.5.20 Chrome/100.0.4896.160 Electron/18.3.5.4-b478491100 Safari/537.36 Channel/pckk_other_ch\",\n            \"referer\": homeUrl\n        });\n}\n\nfunction getDriveInfo() {\n    return requestHttp(api + \"/1/clouddrive/share/sharepage/dir?pr=\" + pr + \"&fr=pc&aver=1\").start(true);\n}\n\nfunction createSaveTask(fid, fid_token, pwd_id, stoken) {\n    let driveInfo = getDriveInfo();\n    return requestHttp(api + \"/1/clouddrive/share/sharepage/save?pr=\" + pr + \"&fr=pc\").setStartRequestFunc(post).body({\n        \"fid_list\": [\n            fid\n        ],\n        \"fid_token_list\": [\n            fid_token\n        ],\n        \"to_pdir_fid\": driveInfo.data.dir.fid,\n        \"pwd_id\": pwd_id,\n        \"stoken\": stoken,\n        \"pdir_fid\": driveInfo.data.dir.pdir_fid\n    }).start(true);\n}\n\nfunction createDeleteTask(fid) {\n    let driveInfo = getDriveInfo();\n    return requestHttp(api + \"/1/clouddrive/file/delete?pr=\" + pr + \"&fr=pc\").setStartRequestFunc(post).body({\n        \"action_type\": 2,\n        \"filelist\": [\n            fid\n        ],\n        \"exclude_fids\": []\n    }).start(true);\n}\n\nfunction task(task_id, retry_index) {\n    return requestHttp(api + \"/1/clouddrive/task\").buildUrl({\n        pr: pr,\n        fr: \"pc\",\n        task_id: task_id,\n        retry_index: retry_index\n    }).start(true);\n}\n\nfunction queryTask(task_id) {\n    for (let i = 0; i < 9; i++) {\n        try {\n            let res = task(task_id, i + \"\");\n            if (res.data.status === 2) {\n                waitSleep(1000);\n                return res.data.save_as.save_as_top_fids[0];\n            }\n            waitSleep(300 * (i + 1));\n        } catch (e) {}\n    }\n    return void(0);\n}\n\nfunction queryTaskStatus(task_id) {\n    for (let i = 0; i < 6; i++) {\n        try {\n            let res = task(task_id, i + \"\");\n            if (res.data.status === 2) {\n                waitSleep(1000);\n                return true;\n            }\n            waitSleep(300);\n        } catch (e) {}\n    }\n    return false;\n}\n\nfunction getPreviewVideo(fid) {\n    return requestHttp(api + \"/1/clouddrive/file/v2/play?pr=\" + pr + \"&fr=pc\").body({\n        \"fid\": fid,\n        \"resolutions\": \"normal,low,high,super,2k,4k\",\n        \"supports\": \"fmp4,m3u8\"\n    }).setStartRequestFunc(post).start(true);\n}\n\n\n\nfunction getDownloadUrl(fid) {\n    return requestHttp(api + \"/1/clouddrive/file/download?pr=\" + pr + \"&fr=pc\").body({\n        \"fids\": [fid]\n    }).setStartRequestFunc(post).start(true);\n}\n\nfunction getPlayUrl(fid, fid_token, pwd_id, stoken, category) {\n    try {\n        if (!cookie) return \"toast://è¯·ç™»å½•è´¦å·\";\n        let taskId = createSaveTask(fid, fid_token, pwd_id, stoken).data.task_id;\n        let asfid = queryTask(taskId);\n        if (!asfid) {\n            return \"toast://è·å–å¤±è´¥\";\n        }\n        let playCookie = cookieManage.get();\n        if (pr === \"UCBrowser\") {\n            playCookie = cookie;\n        }\n        let playHeader = {\n            Referer: homeUrl,\n            cookie: playCookie,\n            \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/100.0.4896.58 UCBrowser/16.5.8.1309 Mobile Safari/537.36\"\n        };\n        let playHeaders = Object.assign({}, playHeader, {\n            \"User-Agent\": \"LogStatistic\"\n        });\n        if (category == \"video\") {\n            let playMode = getItem(\"quark_playMode\", \"è½¬ç \");\n            if (playMode === \"è½¬ç \") {\n                let videoRes = getPreviewVideo(asfid);\n\n                let videoList = videoRes.data.video_list;\n                let playList = {\n                    names: [],\n                    urls: [],\n                    headers: []\n                };\n                videoList.filter(v => v.accessable).forEach(v => {\n                    playList.names.push(v.resolution);\n                    playList.urls.push(v.video_info.url + \"#isVideo=true#\");\n                    playList.headers.push(playHeaders);\n                });\n                createDeleteTask(asfid);\n                return JSON.stringify(playList);\n            } else {\n\n                let playUrl = getDownloadUrl(asfid).data[0].download_url;\n\n                let playList = {\n                    names: [playMode],\n                    urls: [playUrl + \"#isVideo=true#\"+(playMode===\"åŸç”»\"?\"#fastPlayMode##threads=\" + getItem(\"speedThread\", \"10\") + \"#\":\"\")],\n                    headers: [playHeaders]\n                }\n                createDeleteTask(asfid);\n                return JSON.stringify(playList);\n            }\n        } else {\n            let playUrl = getDownloadUrl(asfid).data[0].download_url;\n\n            createDeleteTask(asfid);\n            if (category === 'audio') {\n                let playList = {\n                    names: [\"éŸ³é¢‘\"],\n                    urls: [playUrl + \"#isVideo=true#\"],\n                    headers: [playHeader],\n                    lyric: \"\"\n                }\n                return JSON.stringify(playList);\n            } else if (category === 'image') {\n                return $(playUrl, playHeader).image();\n            } else {\n                playHeader = Object.keys(playHeader).map(key => key + \"@\" + String(playHeader[key]).replace(/;/g, \"ï¼›ï¼›\"));\n                return \"download://\" + playUrl + \";{\" + playHeader.join(\"&&\") + \"}\";\n            }\n        }\n    } catch (e) {\n        if (e.message.includes(\"require login\")) {\n            toast(\"æœªç™»å½•æˆ–ç™»å½•è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•\");\n            return \"hiker://page/login#noRecordHistory##noHistory#?from=\"+fromDrive;\n        }\n        return \"toast://\" + e.toString();\n    }\n}\n\n$.exports = {\n    getPlayUrl\n};"},{"col_type":"movie_3","name":"ç™»å½•è´¦å·","path":"login","rule":"js:\nlet d = [];\nsetPageTitle(\"ç™»å½•è´¦å·\");\naddListener(\"onClose\", () => clearMyVar(\"cookie\"));\nlet from=getParam(\"from\",\"\");\n\nd.push({\n    title: \"â€œâ€œç¡®è®¤ç™»å½•â€â€\",\n    url: $(\"#noLoading#\").lazyRule((from) => {\n        //let cm = android.webkit.CookieManager.getInstance();\n        //let cm = com.tencent.smtt.sdk.CookieManager.getInstance();\n        //let cookie = String(cm.getCookie(\"https://pan.quark.cn\") || \"\");\n        let cookie = getMyVar(\"cookie\", \"\");\n        if ($.require(\"tool\").isLoginCookie(cookie)) {\n            if(from===\"uc\"){\n                setItem(\"ucCookie\", cookie);\n            }else{\n                setItem(\"quarkCookie\", cookie);\n            }\n            back();\n            return \"toast://ç™»å½•æˆåŠŸ\";\n        }\n        return \"toast://æœªç™»å½•\";\n    }, from),\n    desc: \"â€œâ€œâ€â€<small>ç‚¹å‡»å¤´åƒå¯ä»¥é€€å‡ºè´¦å·é‡æ–°ç™»å½•</small>\",\n    col_type: \"text_center_1\"\n});\nd.push({\n    col_type: \"line_blank\"\n});\nlet durl=from===\"uc\"?\"https://drive.uc.cn\":\"https://pan.quark.cn\";\nd.push({\n    col_type: \"x5_webview_single\",\n    url: durl,\n    desc: \"list&&screen-150\",\n    extra: {\n        ua: PC_UA,\n        js: $.toString((title, durl) => {\n            let cookie = \"\";\n            setInterval(() => {\n                cookie = fba.getCookie(durl);\n                fba.putVar(title + \"@cookie\", cookie);\n            }, 200);\n        }, MY_RULE.title, durl)\n    }\n});\nsetResult(d)"},{"col_type":"movie_3","name":"å·¥å…·","path":"tool","rule":"js:\n\n$.exports={\n    isLoginCookie(cookie){\n        return !!(cookie  && cookie.includes(\"__uid=\") && cookie.includes(\"__puus=\"));\n    }\n};"},{"col_type":"movie_3","name":"ä¸ªäººè´¦å·è®¾ç½®","path":"account","rule":"$.exports = $([\"Cookieç™»å½•\", \"ç½‘é¡µç™»å½•\", \"å¤åˆ¶Cookie\", \"æ¸…é™¤Cookie\", \"UCç½‘é¡µç™»å½•\",\"UCCookieç™»å½•\",\"å¤åˆ¶UCCookie\",\"æ¸…é™¤UCCookie\"]).select((isr) => {\n    if (input === \"ç½‘é¡µç™»å½•\") {\n        return \"hiker://page/login#noRecordHistory##noHistory#\";\n    } else if (input === \"Cookieç™»å½•\") {\n        return $(\"\", \"è¯·è¾“å…¥Cookie\").input((isr) => {\n            if ($.require(\"tool\").isLoginCookie(input)) {\n                setItem(\"quarkCookie\", input.replace(/\\s/g, \"\"));\n                isr && refreshPage();\n                return \"toast://è®¾ç½®æˆåŠŸ\";\n            } else {\n                return \"toast://Cookieæ ¼å¼é”™è¯¯\";\n            }\n        }, isr);\n    } else if (input === \"ä»TVBOXè·å–Cookie\") {\n        let path = \"/storage/emulated/0/TV/.quark_user\";\n        if (fileExist(\"file://\" + path)) {\n            if (!new java.io.File(path).canRead()) {\n                return $(\"æ²¡æœ‰æƒé™è¯»å–Cookieæ–‡ä»¶ï¼Œè¯·æ‰“å¼€æ‰€æœ‰æ–‡ä»¶æƒé™\\næµ·é˜”è®¾ç½®->æ›´å¤šåŠŸèƒ½->å†…éƒ¨æ–‡ä»¶ç®¡ç†->å³ä¸Šè§’\").confirm(() => {});\n            }\n            try {\n                let json = JSON.parse(fetch(\"file://\" + path));\n                let cookie = json.cookie;\n                if ($.require(\"tool\").isLoginCookie(cookie)) {\n                    setItem(\"quarkCookie\", cookie);\n                    isr && refreshPage();\n                    return \"toast://è®¾ç½®æˆåŠŸ\";\n                } else {\n                    return \"toast://Cookieæ ¼å¼é”™è¯¯\";\n                }\n            } catch (e) {\n                return \"toast://è·å–å¤±è´¥å…±äº«æ–‡ä»¶æŸå\";\n            }\n        } else {\n            return $(\"æœªæ£€æµ‹åˆ°TVBOXçš„Cookieæ–‡ä»¶\\nè¯·ä½¿ç”¨è¿‡åå†å°è¯•\").confirm(() => {});\n        }\n    } else if (input === \"å¤åˆ¶Cookie\") {\n        let cookie = getItem(\"quarkCookie\", \"\");\n        if (cookie) {\n            return \"copy://\" + cookie;\n        } else {\n            return \"toast://æœªç™»å½•\";\n        }\n    } else if(input===\"æ¸…é™¤Cookie\"){\n        clearItem(\"quarkCookie\");\n        isr && refreshPage();\n        return \"toast://é€€å‡ºç™»å½•\";\n    }else if (input === \"UCç½‘é¡µç™»å½•\") {\n        return \"hiker://page/login#noRecordHistory##noHistory#?from=uc\";\n    }else if (input === \"UCCookieç™»å½•\") {\n        return $(\"\", \"è¯·è¾“å…¥Cookie\").input((isr) => {\n            if ($.require(\"tool\").isLoginCookie(input)) {\n                setItem(\"ucCookie\", input.replace(/\\s/g, \"\"));\n                isr && refreshPage();\n                return \"toast://è®¾ç½®æˆåŠŸ\";\n            } else {\n                return \"toast://Cookieæ ¼å¼é”™è¯¯\";\n            }\n        }, isr);\n    }else if (input === \"å¤åˆ¶UCCookie\") {\n        let cookie = getItem(\"ucCookie\", \"\");\n        if (cookie) {\n            return \"copy://\" + cookie;\n        } else {\n            return \"toast://æœªç™»å½•\";\n        }\n    } else if(input===\"æ¸…é™¤UCCookie\"){\n        clearItem(\"ucCookie\");\n        isr && refreshPage();\n        return \"toast://é€€å‡ºç™»å½•\";\n    }\n}, $.importParam);"}],"title":"Quark.ç®€","author":"@LoyDgIk","version":19,"type":"video","url":"hiker://empty##","col_type":"movie_3","class_name":"","class_url":"","area_name":"","area_url":"","sort_name":"","year_name":"","sort_url":"","year_url":"","find_rule":"js:\nlet d = [];\n\nlet cookie = getItem(\"quarkCookie\", \"\");\n\nif (!$.require(\"tool\").isLoginCookie(cookie)) {\n    clearItem(\"quarkCookie\");\n    d.push({\n        title: '<font color=\"#13B61B\">â– </font><b>æ¸©é¦¨æç¤º<b>',\n        col_type: \"rich_text\",\n    });\n    d.push({\n        url: $.require(\"account\", true),\n        col_type: \"text_1\",\n        title: \"æœªæ£€æµ‹åˆ°ç™»å½•ä¿¡æ¯ï¼Œç‚¹æˆ‘è·³è½¬ç™»å½•è´¦å·é¡µé¢ï¼Œè·å–Quark Cookieåæ–¹å¯ä½¿ç”¨\",\n        extra: {\n            pageTitle: \"ç™»å½•å¤¸å…‹äº‘ç›˜\"\n        }\n    });\n}\nd.push({\n    title: \"äº‘ç®€\",\n    url: \"hiker://home@äº‘ç›˜å›.ç®€\",\n    pic_url: \"hiker://images/icon_left6\",\n    col_type: \"icon_round_small_4\"\n});\nd.push({\n    title: \"æ”¶è—\",\n    url: \"hiker://collection?rule=\" + MY_RULE.title,\n    pic_url: \"hiker://images/icon_good6\",\n    col_type: \"icon_round_small_4\"\n});\nd.push({\n    title: \"å†å²\",\n    url: \"hiker://history?rule=\" + MY_RULE.title,\n    pic_url: \"hiker://images/icon_time6\",\n    col_type: \"icon_round_small_4\"\n});\nd.push({\n    title: \"è´¦å·\",\n    url: $.require(\"account\", true),\n    pic_url: \"hiker://images/icon_setting6\",\n    col_type: \"icon_round_small_4\"\n});\nd.push({\n    title: 'æ‰“å¼€',\n    desc: 'è¯·è¾“å…¥é“¾æ¥/æœç´¢å…³é”®è¯',\n    col_type: 'input',\n    url: $.toString(() => {\n        if (!input) return \"toast://è¯·è¾“å…¥å†…å®¹\";\n        if (!(input.startsWith(\"https://pan.quark.cn/s/\")||input.startsWith(\"https://drive.uc.cn/s/\"))) {\n            return \"hiker://page/sou#noHistory#?rule=äº‘ç›˜å›.ç®€&p=fypage&searchTerms=\" + encodeURIComponent(input);\n        }\n        return \"hiker://page/quarkList?realurl=\" + encodeURIComponent(input) + \"&sharePwd=\";\n    }),\n    extra: {\n        hideSetting: true,\n        pageTitle: \"æœç´¢\"\n    }\n});\nsetResult(d);","searchFind":"","search_url":"","group":"å¼€å‘ä¸­å¿ƒ","detail_col_type":"movie_1","detail_find_rule":"","sdetail_col_type":"movie_1","sdetail_find_rule":"","ua":"mobile","preRule":"","pages":"[{\"col_type\":\"movie_3\",\"name\":\"å¤¸å…‹åˆ—è¡¨API\",\"path\":\"QuarkShareApi\",\"rule\":\"js:\\n//@author LoyDgIk\\nlet httpRequest = $.require(\\\"httpRequest\\\");\\nlet fromDrive = module.importParam;\\nlet pr, baseUrl\\nif (fromDrive === \\\"uc\\\") {\\n    baseUrl = \\\"https://pc-api.uc.cn\\\";\\n    pr = \\\"UCBrowser\\\";\\n} else {\\n    baseUrl = \\\"https://pan.quark.cn\\\";\\n    pr = \\\"ucpro\\\";\\n}\\n\\nfunction QuarkShareApi(shareId, sharePwd) {\\n    this.shareId = shareId;\\n    this.sharePwd = sharePwd;\\n    this.refreshCallBack = (() => void 0);\\n    //this.shareToken = shareToken || this.getShareToken();\\n}\\nObject.assign(QuarkShareApi.prototype, {\\n    setRefresh(refreshCallBack) {\\n        this.refreshCallBack = refreshCallBack;\\n        return this;\\n    },\\n    setToken(shareToken) {\\n        this.shareToken = shareToken;\\n        return this;\\n    },\\n    requestHttp(api) {\\n        return new httpRequest(baseUrl+api).success((body) => {\\n            if (body.status !== 200) {\\n                throw new Error(body.message);\\n            }\\n            return body;\\n        });\\n    },\\n    getToken() {\\n        return this.shareToken || this.getShareToken();\\n    },\\n\\n    getShareToken() {\\n        let result = this.requestHttp(\\\"/1/clouddrive/share/sharepage/token\\\").body({\\n            \\\"pwd_id\\\": this.shareId,\\n            \\\"passcode\\\": this.sharePwd,\\n        }).bodyToString(true).setStartRequestFunc(post).start(true);\\n        this.shareToken = result.data.stoken;\\n        this.refreshCallBack(result.data.stoken, this);\\n        return this.shareToken;\\n    },\\n    getListFile(fileId, page, orderBy) {\\n        let result = this.requestHttp(\\\"/1/clouddrive/share/sharepage/detail?pr=\\\"+pr+\\\"&fr=pc\\\").buildUrl({\\n            pwd_id: this.shareId || \\\"\\\",\\n            stoken: encodeURIComponent(this.getToken() || \\\"\\\"),\\n            pdir_fid: fileId || \\\"\\\",\\n            force: 0,\\n            _page: page,\\n            _size: 100,\\n            _fetch_banner: 1,\\n            _fetch_share: 1,\\n            _fetch_total: 1,\\n            _sort: \\\"file_type:asc,\\\" + orderBy\\n        }).errorWithRetry((err, res, http) => {\\n            if (JSON.parse(res.body).message.includes('stoken')) {\\n                http.mergeHeadAndBody({\\n                    buildUrl: {\\n                        stoken: encodeURIComponent(this.getShareToken()||\\\"\\\")\\n                    }\\n                });\\n                return true;\\n            }\\n        }).start(true);\\n        return result;\\n    }\\n});\\n$.exports = QuarkShareApi;\"},{\"col_type\":\"movie_3\",\"name\":\"httpRequest\",\"path\":\"httpRequest\",\"rule\":\"function httpRequest(url, options) {\\n    this.retryCount = 0;\\n    this.url = url;\\n    this.options = Object.assign({}, options, {\\n        withHeaders: true\\n    });\\n    this.errorCallback = (err, res) => {throw err};\\n    this.errorCallbackWithRetry = (err, res, tryRestart) => false;\\n    this.successCallback = (body, statusCode, headers) => body;\\n    this.errorTypeCallback = (err, res) => err;\\n    this.startRequest = fetch;\\n    this._bodyToString = false;\\n    this.buildParam = void(0);\\n}\\n\\nObject.assign(httpRequest.prototype, {\\n    bodyToString(flag) {\\n        this._bodyToString = !!flag;\\n        return this;\\n    },\\n    body(body) {\\n        this.options.body = body || void 0;\\n        return this;\\n    },\\n    buildUrl(buildParam) {\\n        this.buildParam = buildParam || {};\\n        return this;\\n    },\\n    setStartRequestFunc(func) {\\n        this.startRequest = func;\\n        return this;\\n    },\\n    headers(headers) {\\n        this.options.headers = headers || void 0;\\n        return this;\\n    },\\n    success(successCallback) {\\n        if (typeof successCallback !== \\\"function\\\") return this;\\n        this.successCallback = successCallback;\\n        return this;\\n    },\\n    error(errorCallback) {\\n        if (typeof errorCallback !== \\\"function\\\") return this;\\n        this.errorCallback = errorCallback;\\n        return this;\\n    },\\n    errorType(errorTypeCallback) {\\n        if (typeof errorTypeCallback !== \\\"function\\\") return this;\\n        this.errorTypeCallback = errorTypeCallback;\\n        return this;\\n    },\\n    errorWithRetry(retryCount, errorCallbackWithRetry) {\\n        if (typeof retryCount === \\\"function\\\" && typeof errorCallbackWithRetry === \\\"undefined\\\") {\\n            errorCallbackWithRetry = retryCount;\\n            retryCount = 1;\\n        }\\n        if (typeof errorCallbackWithRetry !== \\\"function\\\") {\\n            return this;\\n        }\\n        this.retryCount = Number(retryCount);\\n        this.errorCallbackWithRetry = errorCallbackWithRetry;\\n        return this;\\n    },\\n    start(toJson) {\\n        let options = Object.assign({}, this.options);\\n        if (typeof options.body === \\\"object\\\" && this._bodyToString) {\\n            options.body = JSON.stringify(options.body);\\n        }\\n        var res = JSON.parse(this.startRequest(this.buildParam?buildUrl(this.url, this.buildParam):this.url, options));\\n        try {\\n            if (res.statusCode >= 200 && res.statusCode <= 300) {\\n                let body = res.body;\\n                if (toJson) {\\n                    body = JSON.parse(body);\\n                }\\n                return this.successCallback(body, res);\\n            } else {\\n                throw new Error(String(res.statusCode));\\n            }\\n        } catch (err) {\\n            try {\\n                err = this.errorTypeCallback(err, res);\\n            } catch (e) {\\n\\n            }\\n            if (this.retryCount) {\\n                let tryResult = this.errorCallbackWithRetry(err, res, this);\\n                if (tryResult) {\\n                    this.retryCount--;\\n                    return this.start(toJson);\\n                } else {\\n                    this.retryCount = 0;\\n                    return this.errorCallback(err, res);\\n                }\\n            } else {\\n                return this.errorCallback(err, res);\\n            }\\n        }\\n    },\\n    setOptions(options) {\\n        this.options = Object.assign({}, options, {\\n            withHeaders: true\\n        });\\n        return this;\\n    },\\n    mergeHeadAndBody(options) {\\n        options = options || {};\\n        Object.assign(this.options.headers||{}, options.headers);\\n        if (typeof this.options.body === \\\"object\\\" && typeof options.body === \\\"object\\\") {\\n            Object.assign(this.options.body||{}, options.body);\\n        }\\n        if (typeof options.buildUrl === \\\"object\\\") {\\n            Object.assign(this.buildParam||{}, options.buildUrl);\\n        }\\n        return this;\\n    }\\n});\\n\\nObject.assign(httpRequest, {\\n    fetch(url, options) {\\n        return new httpRequest(url, options);\\n    },\\n    post(url, options) {\\n        return new httpRequest(url, options).setStartRequestFunc(post);\\n    },\\n    request(url, options) {\\n        return new httpRequest(url, options).setStartRequestFunc(request);\\n    },\\n    postRequest(url, options) {\\n        return new httpRequest(url, options).setStartRequestFunc(postRequest);\\n    },\\n    fetchCookie(url, options) {\\n        return new httpRequest(url, options).setStartRequestFunc(fetchCookie);\\n    }\\n});\\n$.exports = httpRequest;\"},{\"col_type\":\"movie_3\",\"name\":\"å¤¸å…‹åˆ—è¡¨\",\"path\":\"quarkList\",\"rule\":\"js:\\nlet d = [];\\n\\naddListener(\\\"onClose\\\", () => clearMyVar(\\\"playUrlCache\\\"));\\naddListener(\\\"onRefresh\\\", () => clearMyVar(\\\"playUrlCache\\\"));\\nlet soUrl = decodeURIComponent(getParam(\\\"realurl\\\", \\\"\\\"));\\nlet fromDrive = MY_PARAMS.fromDrive||\\\"quark\\\";\\n\\nif(soUrl.includes(\\\"drive.uc.cn\\\")){\\n    fromDrive = \\\"uc\\\";\\n}\\nlet realurl = soUrl.split(\\\"?\\\")[0];\\nlet urlData = realurl.split(\\\"/\\\");\\n\\nlet shareId = MY_PARAMS.shareId || urlData[4].replace(\\\"#\\\", \\\"\\\");\\nlet sharePwd = getParam(\\\"sharePwd\\\", MY_PARAMS.sharePwd || getParam(\\\"passcode\\\", \\\"\\\", soUrl) || \\\"\\\");\\nlet shareToken = getParam(\\\"shareToken\\\", MY_PARAMS.shareToken || \\\"\\\");\\n\\nlet fileId = MY_PARAMS.fileId;\\n\\nlet sort = {\\n    \\\"åç§°æ­£åº\\\": \\\"file_name:asc\\\",\\n    \\\"åç§°å€’åº\\\": \\\"file_name:desc\\\",\\n    \\\"æ—¶é—´æ­£åº\\\": \\\"updated_at:asc\\\",\\n    \\\"æ—¶é—´å€’åº\\\": \\\"updated_at:desc\\\"\\n};\\nlet styles = [\\\"text_1\\\", \\\"avatar\\\"];\\n\\nlet sortValue = sort[getItem(\\\"sortKey\\\", \\\"åç§°æ­£åº\\\")];\\nlet style = getItem(\\\"style\\\", styles[0]);\\nif (MY_PAGE == 1) {\\n    d.push({\\n        title: fromDrive===\\\"uc\\\"?\\\"UCç½‘ç›˜\\\":\\\"å¤¸å…‹ç½‘ç›˜\\\",\\n        col_type: \\\"icon_5\\\",\\n        pic_url: fromDrive===\\\"uc\\\"?\\\"https://hikerfans.com/tubiao/erdi/14.png\\\":\\\"hiker://images/icon_kuake\\\",\\n        url: $(\\\"ç‚¹å‡»åŠŸèƒ½æŒ‰é’®=>ä¸ªäººè´¦å·ç®¡ç†å³å¯ç™»å½•è´¦å·\\\").confirm(()=>{}),\\n    });\\n    d.push({\\n        title: style,\\n        url: $(styles, 1, 'è¯·é€‰æ‹©').select(() => {\\n            setItem('style', input);\\n            refreshPage();\\n        }),\\n        pic_url: \\\"https://hikerfans.com/img/ali_icon.svg\\\",\\n        col_type: \\\"icon_5\\\"\\n    });\\n    d.push({\\n        title: getItem(\\\"sortKey\\\", \\\"åç§°æ­£åº\\\"),\\n        url: $(Object.keys(sort), 1, 'è¯·é€‰æ‹©').select(() => {\\n            setItem(\\\"sortKey\\\", input)\\n            refreshPage();\\n        }),\\n        pic_url: \\\"https://hikerfans.com/img/ali_sort.svg\\\",\\n        col_type: \\\"icon_5\\\"\\n    });\\n    d.push({\\n        title: getItem(\\\"quark_playMode\\\", \\\"è½¬ç \\\"),\\n        url: $([\\\"è½¬ç \\\", \\\"åŸç”»\\\", \\\"æ™®é€šåŸç”»\\\"], 2, \\\"æ’­æ”¾æ¨¡å¼\\\").select(() => {\\n            setItem(\\\"quark_playMode\\\", input);\\n            refreshPage();\\n            return \\\"toast://åˆ‡æ¢æˆåŠŸ\\\";\\n        }),\\n        col_type: \\\"icon_5\\\",\\n        pic_url: \\\"https://hikerfans.com/img/ali_play.svg\\\",\\n    });\\n    d.push({\\n        title: \\\"åŠŸèƒ½\\\",\\n        url: $([\\\"è·³è½¬å¤¸å…‹APP\\\", \\\"å¤åˆ¶åˆ†äº«é“¾æ¥\\\", \\\"ä¸ªäººè´¦å·ç®¡ç†\\\", \\\"åŸç”»ä¸‹è½½çº¿ç¨‹\\\"], 2).select((shareId, sharePwd) => {\\n            if (input === \\\"è·³è½¬å¤¸å…‹APP\\\") {\\n                return \\\"qklink://www.uc.cn/b20b84fd735a8dd3f7541129bacc4e9a?action=open_url&url=https://pan.quark.cn/s/\\\" + shareId;\\n            } else if (input === \\\"ä¸ªäººè´¦å·ç®¡ç†\\\") {\\n                return $.require(\\\"account\\\");\\n            } else if (input === \\\"åŸç”»ä¸‹è½½çº¿ç¨‹\\\") {\\n                return $(getItem(\\\"speedThread\\\", \\\"10\\\"), \\\"è¯·è¾“å…¥3-32ä¹‹é—´çš„æ•´æ•°\\\").input(() => {\\n                    let speedThread = parseInt(input);\\n                    if (speedThread < 3 || speedThread > 32) {\\n                        return \\\"toast://è®¾ç½®ä¸åˆæ³•\\\";\\n                    }\\n                    setItem(\\\"speedThread\\\", String(speedThread));\\n                    return \\\"toast://è®¾ç½®æˆåŠŸ\\\";\\n                });\\n            } else if (input === \\\"å¤åˆ¶åˆ†äº«é“¾æ¥\\\") {\\n                return \\\"copy://\\\" + buildUrl(\\\"https://pan.quark.cn/s/\\\" + shareId, {\\n                    passcode: sharePwd\\n                });\\n            }\\n        }, shareId, sharePwd),\\n        col_type: \\\"icon_5\\\",\\n        pic_url: \\\"https://hikerfans.com/img/ali_fileinto.svg\\\",\\n    });\\n    d.push({\\n        col_type: 'line_blank'\\n    });\\n}\\n\\n\\nlet QuarkShareApi = $.require(\\\"QuarkShareApi\\\", fromDrive);\\nlet quarkShareApi = new QuarkShareApi(shareId, sharePwd).setToken(shareToken).setRefresh((shareToken) => {\\n    MY_PARAMS.shareToken = shareToken;\\n    setPageParams(MY_PARAMS);\\n});\\n\\nfunction formatSize(size) {\\n    if (!size) {\\n        return '';\\n    }\\n    const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\\n    let i = 0;\\n    while (size >= 1024) {\\n        size /= 1024;\\n        i++;\\n    }\\n    size = i ? Number(size.toFixed(2)) : size;\\n    return `${size} ${units[i]}`;\\n}\\n\\nlet subExts = [\\\"vtt\\\", \\\"srt\\\", \\\"ass\\\"];\\nlet titleHead = {\\n    video: \\\"ğŸ¬\\\",\\n    audio: \\\"ğŸµ\\\",\\n    doc: \\\"ğŸ“‘\\\",\\n    image: \\\"ğŸ–¼\\\",\\n    archive: \\\"ğŸ“¦\\\",\\n    \\\"default\\\": \\\"â“\\\"\\n};\\n\\nfunction getHead(type, ext) {\\n    let head = titleHead[type];\\n    /*if (subExts.includes(ext)) {\\n        head = \\\"ğŸ•¸\\\";\\n    }*/\\n    return head || \\\"â“\\\";\\n}\\ntry {\\n    var res = quarkShareApi.getListFile(fileId, MY_PAGE, sortValue);\\n    //è®¾ç½®æ ‡é¢˜\\n    setPageTitle(res.data.share.title);\\n    var list = res.data.list || [];\\n    if (list.length === 0 && !fileId) {\\n        res = quarkShareApi.getListFile(res.data.share.first_fid, MY_PAGE, sortValue);\\n        setPageTitle(res.data.share.title);\\n        var list = res.data.list || [];\\n    }\\n    list.forEach(item => {\\n        //åˆ¤æ–­æ˜¯å¦æ–‡ä»¶å¤¹\\n        if (item.dir) {\\n            d.push({\\n                title: \\\"ğŸ“‚\\\" + item.file_name,\\n                desc: $.dateFormat(item.updated_at, 'yyyy-MM-dd') + '  ' + item.include_items + 'é¡¹  ',\\n                pic_url: \\\"https://hikerfans.com/tubiao/messy/27.svg\\\",\\n                url: \\\"hiker://page/quarkList?page=fypage\\\",\\n                col_type: style,\\n                extra: {\\n                    shareId,\\n                    sharePwd,\\n                    shareToken: quarkShareApi.getToken(),\\n                    fileId: item.fid,\\n                    inheritTitle: false,\\n                    fromDrive\\n                }\\n            });\\n        } else {\\n            d.push({\\n                title: getHead(item.obj_category) + item.file_name,\\n                desc: $.dateFormat(item.updated_at, 'yyyy-MM-dd') + '  ' + formatSize(item.size),\\n                pic_url: item.thumbnail,\\n                url: $().lazyRule((fid, fid_token, pwd_id, stoken, category, fromDrive) => {\\n                    let playUrlCache = storage0.getMyVar(\\\"playUrlCache\\\", {});\\n                    if (playUrlCache[fid]) {\\n                        return playUrlCache[fid];\\n                    } else {\\n                        let url = $.require(\\\"play\\\", fromDrive).getPlayUrl(fid, fid_token, pwd_id, stoken, category);\\n                        playUrlCache[fid] = url;\\n                        storage0.putMyVar(\\\"playUrlCache\\\", playUrlCache);\\n                        return url;\\n                    }\\n                }, item.fid, item.share_fid_token, shareId, quarkShareApi.getToken(), item.obj_category, fromDrive),\\n                col_type: style,\\n                extra: {\\n                    id: item.fid,\\n                    inheritTitle: false,\\n                    cls: 'playlist ' + item.obj_category\\n                }\\n            })\\n        }\\n        \\n    });\\n} catch (e) {\\n    d.push({\\n        title: e.message,\\n        url: 'hiker://empty',\\n        col_type: 'text_center_1',\\n        extra: {\\n            lineVisible: false\\n        }\\n    });\\n    if (e.message.includes(\\\"æå–ç \\\")) {\\n        d.push({\\n            title: \\\"è¾“å…¥æå–ç \\\",\\n            url: $().input((MY_PARAMS) => {\\n                setPageParams(Object.assign({}, MY_PARAMS, {\\n                    sharePwd: input\\n                }));\\n                refreshPage();\\n            }, MY_PARAMS),\\n            col_type: \\\"text_center_1\\\"\\n        });\\n    }\\n}\\nsetResult(d);\"},{\"col_type\":\"movie_3\",\"name\":\"play\",\"path\":\"play\",\"rule\":\"js:\\nlet fromDrive = module.importParam;\\nlet pr, homeUrl, api, cookie;\\nif (fromDrive === \\\"uc\\\") {\\n    homeUrl = \\\"https://drive.uc.cn/\\\";\\n    pr = \\\"UCBrowser\\\";\\n    api = \\\"https://pc-api.uc.cn\\\";\\n    cookie = getItem(\\\"ucCookie\\\", \\\"\\\");\\n} else {\\n    homeUrl = \\\"https://drive.quark.cn/\\\";\\n    pr = \\\"ucpro\\\";\\n    api = \\\"https://drive.quark.cn\\\";\\n    cookie = getItem(\\\"quarkCookie\\\", \\\"\\\");\\n}\\n\\nfunction CookieManage(cookie) {\\n    this.cookie = {};\\n    this.add(cookie);\\n}\\nObject.assign(CookieManage.prototype, {\\n    add(cookie) {\\n        let cookies = [];\\n        if (typeof cookie === \\\"string\\\") {\\n            cookies = cookie.split(\\\";\\\");\\n        } else if (Array.isArray(cookie)) {\\n            cookies = cookie;\\n        }\\n        cookies.forEach(v => {\\n            v = v.split(\\\"=\\\");\\n            if (v.length < 2) return;\\n            this.cookie[v[0].trim()] = v[1].trim();\\n        });\\n    },\\n    get() {\\n        return Object.entries(this.cookie).map(v => v[0] + \\\"=\\\" + v[1]).join(\\\";\\\");\\n    }\\n});\\nconst cookieManage = new CookieManage(cookie);\\nlet httpRequest = $.require(\\\"httpRequest\\\");\\n\\nfunction waitSleep(time) {\\n    java.lang.Thread.sleep(time || 600);\\n}\\n\\nfunction requestHttp(url) {\\n    return new httpRequest(url)\\n        .success((body, res) => {\\n            if (body.status !== 200) {\\n                throw new Error(body.message);\\n            }\\n            log(url);\\n            log(res.headers)\\n            cookieManage.add(res.headers[\\\"set-cookie\\\"]);\\n            return body;\\n        })\\n        .errorType((err, res) => {\\n            return new Error(JSON.parse(res.body).message);\\n        })\\n        .bodyToString(true)\\n        .headers({\\n            cookie: cookieManage.get(),\\n            \\\"User-Agent\\\": \\\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) quark-cloud-drive/2.5.20 Chrome/100.0.4896.160 Electron/18.3.5.4-b478491100 Safari/537.36 Channel/pckk_other_ch\\\",\\n            \\\"referer\\\": homeUrl\\n        });\\n}\\n\\nfunction getDriveInfo() {\\n    return requestHttp(api + \\\"/1/clouddrive/share/sharepage/dir?pr=\\\" + pr + \\\"&fr=pc&aver=1\\\").start(true);\\n}\\n\\nfunction createSaveTask(fid, fid_token, pwd_id, stoken) {\\n    let driveInfo = getDriveInfo();\\n    return requestHttp(api + \\\"/1/clouddrive/share/sharepage/save?pr=\\\" + pr + \\\"&fr=pc\\\").setStartRequestFunc(post).body({\\n        \\\"fid_list\\\": [\\n            fid\\n        ],\\n        \\\"fid_token_list\\\": [\\n            fid_token\\n        ],\\n        \\\"to_pdir_fid\\\": driveInfo.data.dir.fid,\\n        \\\"pwd_id\\\": pwd_id,\\n        \\\"stoken\\\": stoken,\\n        \\\"pdir_fid\\\": driveInfo.data.dir.pdir_fid\\n    }).start(true);\\n}\\n\\nfunction createDeleteTask(fid) {\\n    let driveInfo = getDriveInfo();\\n    return requestHttp(api + \\\"/1/clouddrive/file/delete?pr=\\\" + pr + \\\"&fr=pc\\\").setStartRequestFunc(post).body({\\n        \\\"action_type\\\": 2,\\n        \\\"filelist\\\": [\\n            fid\\n        ],\\n        \\\"exclude_fids\\\": []\\n    }).start(true);\\n}\\n\\nfunction task(task_id, retry_index) {\\n    return requestHttp(api + \\\"/1/clouddrive/task\\\").buildUrl({\\n        pr: pr,\\n        fr: \\\"pc\\\",\\n        task_id: task_id,\\n        retry_index: retry_index\\n    }).start(true);\\n}\\n\\nfunction queryTask(task_id) {\\n    for (let i = 0; i < 9; i++) {\\n        try {\\n            let res = task(task_id, i + \\\"\\\");\\n            if (res.data.status === 2) {\\n                waitSleep(1000);\\n                return res.data.save_as.save_as_top_fids[0];\\n            }\\n            waitSleep(300 * (i + 1));\\n        } catch (e) {}\\n    }\\n    return void(0);\\n}\\n\\nfunction queryTaskStatus(task_id) {\\n    for (let i = 0; i < 6; i++) {\\n        try {\\n            let res = task(task_id, i + \\\"\\\");\\n            if (res.data.status === 2) {\\n                waitSleep(1000);\\n                return true;\\n            }\\n            waitSleep(300);\\n        } catch (e) {}\\n    }\\n    return false;\\n}\\n\\nfunction getPreviewVideo(fid) {\\n    return requestHttp(api + \\\"/1/clouddrive/file/v2/play?pr=\\\" + pr + \\\"&fr=pc\\\").body({\\n        \\\"fid\\\": fid,\\n        \\\"resolutions\\\": \\\"normal,low,high,super,2k,4k\\\",\\n        \\\"supports\\\": \\\"fmp4,m3u8\\\"\\n    }).setStartRequestFunc(post).start(true);\\n}\\n\\n\\n\\nfunction getDownloadUrl(fid) {\\n    return requestHttp(api + \\\"/1/clouddrive/file/download?pr=\\\" + pr + \\\"&fr=pc\\\").body({\\n        \\\"fids\\\": [fid]\\n    }).setStartRequestFunc(post).start(true);\\n}\\n\\nfunction getPlayUrl(fid, fid_token, pwd_id, stoken, category) {\\n    try {\\n        if (!cookie) return \\\"toast://è¯·ç™»å½•è´¦å·\\\";\\n        let taskId = createSaveTask(fid, fid_token, pwd_id, stoken).data.task_id;\\n        let asfid = queryTask(taskId);\\n        if (!asfid) {\\n            return \\\"toast://è·å–å¤±è´¥\\\";\\n        }\\n        let playCookie = cookieManage.get();\\n        if (pr === \\\"UCBrowser\\\") {\\n            playCookie = cookie;\\n        }\\n        let playHeader = {\\n            Referer: homeUrl,\\n            cookie: playCookie,\\n            \\\"User-Agent\\\": \\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/100.0.4896.58 UCBrowser/16.5.8.1309 Mobile Safari/537.36\\\"\\n        };\\n        let playHeaders = Object.assign({}, playHeader, {\\n            \\\"User-Agent\\\": \\\"LogStatistic\\\"\\n        });\\n        if (category == \\\"video\\\") {\\n            let playMode = getItem(\\\"quark_playMode\\\", \\\"è½¬ç \\\");\\n            if (playMode === \\\"è½¬ç \\\") {\\n                let videoRes = getPreviewVideo(asfid);\\n\\n                let videoList = videoRes.data.video_list;\\n                let playList = {\\n                    names: [],\\n                    urls: [],\\n                    headers: []\\n                };\\n                videoList.filter(v => v.accessable).forEach(v => {\\n                    playList.names.push(v.resolution);\\n                    playList.urls.push(v.video_info.url + \\\"#isVideo=true#\\\");\\n                    playList.headers.push(playHeaders);\\n                });\\n                createDeleteTask(asfid);\\n                return JSON.stringify(playList);\\n            } else {\\n\\n                let playUrl = getDownloadUrl(asfid).data[0].download_url;\\n\\n                let playList = {\\n                    names: [playMode],\\n                    urls: [playUrl + \\\"#isVideo=true#\\\"+(playMode===\\\"åŸç”»\\\"?\\\"#fastPlayMode##threads=\\\" + getItem(\\\"speedThread\\\", \\\"10\\\") + \\\"#\\\":\\\"\\\")],\\n                    headers: [playHeaders]\\n                }\\n                createDeleteTask(asfid);\\n                return JSON.stringify(playList);\\n            }\\n        } else {\\n            let playUrl = getDownloadUrl(asfid).data[0].download_url;\\n\\n            createDeleteTask(asfid);\\n            if (category === 'audio') {\\n                let playList = {\\n                    names: [\\\"éŸ³é¢‘\\\"],\\n                    urls: [playUrl + \\\"#isVideo=true#\\\"],\\n                    headers: [playHeader],\\n                    lyric: \\\"\\\"\\n                }\\n                return JSON.stringify(playList);\\n            } else if (category === 'image') {\\n                return $(playUrl, playHeader).image();\\n            } else {\\n                playHeader = Object.keys(playHeader).map(key => key + \\\"@\\\" + String(playHeader[key]).replace(/;/g, \\\"ï¼›ï¼›\\\"));\\n                return \\\"download://\\\" + playUrl + \\\";{\\\" + playHeader.join(\\\"&&\\\") + \\\"}\\\";\\n            }\\n        }\\n    } catch (e) {\\n        if (e.message.includes(\\\"require login\\\")) {\\n            toast(\\\"æœªç™»å½•æˆ–ç™»å½•è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•\\\");\\n            return \\\"hiker://page/login#noRecordHistory##noHistory#?from=\\\"+fromDrive;\\n        }\\n        return \\\"toast://\\\" + e.toString();\\n    }\\n}\\n\\n$.exports = {\\n    getPlayUrl\\n};\"},{\"col_type\":\"movie_3\",\"name\":\"ç™»å½•è´¦å·\",\"path\":\"login\",\"rule\":\"js:\\nlet d = [];\\nsetPageTitle(\\\"ç™»å½•è´¦å·\\\");\\naddListener(\\\"onClose\\\", () => clearMyVar(\\\"cookie\\\"));\\nlet from=getParam(\\\"from\\\",\\\"\\\");\\n\\nd.push({\\n    title: \\\"â€œâ€œç¡®è®¤ç™»å½•â€â€\\\",\\n    url: $(\\\"#noLoading#\\\").lazyRule((from) => {\\n        //let cm = android.webkit.CookieManager.getInstance();\\n        //let cm = com.tencent.smtt.sdk.CookieManager.getInstance();\\n        //let cookie = String(cm.getCookie(\\\"https://pan.quark.cn\\\") || \\\"\\\");\\n        let cookie = getMyVar(\\\"cookie\\\", \\\"\\\");\\n        if ($.require(\\\"tool\\\").isLoginCookie(cookie)) {\\n            if(from===\\\"uc\\\"){\\n                setItem(\\\"ucCookie\\\", cookie);\\n            }else{\\n                setItem(\\\"quarkCookie\\\", cookie);\\n            }\\n            back();\\n            return \\\"toast://ç™»å½•æˆåŠŸ\\\";\\n        }\\n        return \\\"toast://æœªç™»å½•\\\";\\n    }, from),\\n    desc: \\\"â€œâ€œâ€â€<small>ç‚¹å‡»å¤´åƒå¯ä»¥é€€å‡ºè´¦å·é‡æ–°ç™»å½•</small>\\\",\\n    col_type: \\\"text_center_1\\\"\\n});\\nd.push({\\n    col_type: \\\"line_blank\\\"\\n});\\nlet durl=from===\\\"uc\\\"?\\\"https://drive.uc.cn\\\":\\\"https://pan.quark.cn\\\";\\nd.push({\\n    col_type: \\\"x5_webview_single\\\",\\n    url: durl,\\n    desc: \\\"list&&screen-150\\\",\\n    extra: {\\n        ua: PC_UA,\\n        js: $.toString((title, durl) => {\\n            let cookie = \\\"\\\";\\n            setInterval(() => {\\n                cookie = fba.getCookie(durl);\\n                fba.putVar(title + \\\"@cookie\\\", cookie);\\n            }, 200);\\n        }, MY_RULE.title, durl)\\n    }\\n});\\nsetResult(d)\"},{\"col_type\":\"movie_3\",\"name\":\"å·¥å…·\",\"path\":\"tool\",\"rule\":\"js:\\n\\n$.exports={\\n    isLoginCookie(cookie){\\n        return !!(cookie  && cookie.includes(\\\"__uid=\\\") && cookie.includes(\\\"__puus=\\\"));\\n    }\\n};\"},{\"col_type\":\"movie_3\",\"name\":\"ä¸ªäººè´¦å·è®¾ç½®\",\"path\":\"account\",\"rule\":\"$.exports = $([\\\"Cookieç™»å½•\\\", \\\"ç½‘é¡µç™»å½•\\\", \\\"å¤åˆ¶Cookie\\\", \\\"æ¸…é™¤Cookie\\\", \\\"UCç½‘é¡µç™»å½•\\\",\\\"UCCookieç™»å½•\\\",\\\"å¤åˆ¶UCCookie\\\",\\\"æ¸…é™¤UCCookie\\\"]).select((isr) => {\\n    if (input === \\\"ç½‘é¡µç™»å½•\\\") {\\n        return \\\"hiker://page/login#noRecordHistory##noHistory#\\\";\\n    } else if (input === \\\"Cookieç™»å½•\\\") {\\n        return $(\\\"\\\", \\\"è¯·è¾“å…¥Cookie\\\").input((isr) => {\\n            if ($.require(\\\"tool\\\").isLoginCookie(input)) {\\n                setItem(\\\"quarkCookie\\\", input.replace(/\\\\s/g, \\\"\\\"));\\n                isr && refreshPage();\\n                return \\\"toast://è®¾ç½®æˆåŠŸ\\\";\\n            } else {\\n                return \\\"toast://Cookieæ ¼å¼é”™è¯¯\\\";\\n            }\\n        }, isr);\\n    } else if (input === \\\"ä»TVBOXè·å–Cookie\\\") {\\n        let path = \\\"/storage/emulated/0/TV/.quark_user\\\";\\n        if (fileExist(\\\"file://\\\" + path)) {\\n            if (!new java.io.File(path).canRead()) {\\n                return $(\\\"æ²¡æœ‰æƒé™è¯»å–Cookieæ–‡ä»¶ï¼Œè¯·æ‰“å¼€æ‰€æœ‰æ–‡ä»¶æƒé™\\\\næµ·é˜”è®¾ç½®->æ›´å¤šåŠŸèƒ½->å†…éƒ¨æ–‡ä»¶ç®¡ç†->å³ä¸Šè§’\\\").confirm(() => {});\\n            }\\n            try {\\n                let json = JSON.parse(fetch(\\\"file://\\\" + path));\\n                let cookie = json.cookie;\\n                if ($.require(\\\"tool\\\").isLoginCookie(cookie)) {\\n                    setItem(\\\"quarkCookie\\\", cookie);\\n                    isr && refreshPage();\\n                    return \\\"toast://è®¾ç½®æˆåŠŸ\\\";\\n                } else {\\n                    return \\\"toast://Cookieæ ¼å¼é”™è¯¯\\\";\\n                }\\n            } catch (e) {\\n                return \\\"toast://è·å–å¤±è´¥å…±äº«æ–‡ä»¶æŸå\\\";\\n            }\\n        } else {\\n            return $(\\\"æœªæ£€æµ‹åˆ°TVBOXçš„Cookieæ–‡ä»¶\\\\nè¯·ä½¿ç”¨è¿‡åå†å°è¯•\\\").confirm(() => {});\\n        }\\n    } else if (input === \\\"å¤åˆ¶Cookie\\\") {\\n        let cookie = getItem(\\\"quarkCookie\\\", \\\"\\\");\\n        if (cookie) {\\n            return \\\"copy://\\\" + cookie;\\n        } else {\\n            return \\\"toast://æœªç™»å½•\\\";\\n        }\\n    } else if(input===\\\"æ¸…é™¤Cookie\\\"){\\n        clearItem(\\\"quarkCookie\\\");\\n        isr && refreshPage();\\n        return \\\"toast://é€€å‡ºç™»å½•\\\";\\n    }else if (input === \\\"UCç½‘é¡µç™»å½•\\\") {\\n        return \\\"hiker://page/login#noRecordHistory##noHistory#?from=uc\\\";\\n    }else if (input === \\\"UCCookieç™»å½•\\\") {\\n        return $(\\\"\\\", \\\"è¯·è¾“å…¥Cookie\\\").input((isr) => {\\n            if ($.require(\\\"tool\\\").isLoginCookie(input)) {\\n                setItem(\\\"ucCookie\\\", input.replace(/\\\\s/g, \\\"\\\"));\\n                isr && refreshPage();\\n                return \\\"toast://è®¾ç½®æˆåŠŸ\\\";\\n            } else {\\n                return \\\"toast://Cookieæ ¼å¼é”™è¯¯\\\";\\n            }\\n        }, isr);\\n    }else if (input === \\\"å¤åˆ¶UCCookie\\\") {\\n        let cookie = getItem(\\\"ucCookie\\\", \\\"\\\");\\n        if (cookie) {\\n            return \\\"copy://\\\" + cookie;\\n        } else {\\n            return \\\"toast://æœªç™»å½•\\\";\\n        }\\n    } else if(input===\\\"æ¸…é™¤UCCookie\\\"){\\n        clearItem(\\\"ucCookie\\\");\\n        isr && refreshPage();\\n        return \\\"toast://é€€å‡ºç™»å½•\\\";\\n    }\\n}, $.importParam);\"}]","proxy":"","icon":"hiker://images/icon_kuake"}